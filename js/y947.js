document.addEventListener('DOMContentLoaded', () => {
  const todayBtn = document.getElementById('btn-today');
  const copyBtn = document.getElementById('btn-copy');
  const pngBtn = document.getElementById('btn-png');
  const nativeShareBtn = document.getElementById('btn-native-share');
  const recipeFrame = document.getElementById('recipe-frame');
  const recipeTextEl = document.getElementById('recipe-text');
  const shareX = document.getElementById('share-x');
  const shareFacebook = document.getElementById('share-fb');
  const shareLine = document.getElementById('share-line');
  const shareEmail = document.getElementById('share-email');
  // サンプル：今日の満腹感レシピ（任意でサーバから取得する想定）
  const sampleRecipe = `満腹感たっぷり豆腐野菜ボウル
材料：
- 絹ごし豆腐 1丁
- キャベツ 200g（千切り）
- にんじん 1本（細切り）
- きのこ類 100g
- ごまドレッシング小さじ2
作り方：
1. 豆腐は軽く水切りし、一口大にする。
2. 野菜を下茹でするかレンチンして食感を残す。
3. 全てを混ぜてドレッシングで和える。
ポイント：食物繊維と水分量が多いので満腹感が続く。`;
  // 追加レシピ（ダイエット中でも満腹感が得られる詳細レシピを5つ）
  const addedRecipes = [
`鶏むね肉と蒸し野菜のボウル
材料（1人分）：
- 鶏むね肉 100g
- ブロッコリー 100g
- キャベツ 50g
- ミニトマト 4個
- ポン酢 小さじ2
作り方：
1. 鶏むね肉は筋を取り、塩胡椒で下味をつける。
2. 耐熱容器に鶏肉を入れラップをして電子レンジで約2〜3分加熱（厚さにより調整）。
3. ブロッコリーとキャベツは蒸すかレンジで加熱して食感を残す。
4. 全てをボウルに盛り、ポン酢で和える。
ポイント：高タンパクで低脂質。野菜の食物繊維で満腹感が持続する。`,
`オートミールと豆乳の雑炊風
材料（1人分）：
- オートミール 40g（ロールドまたはクイック）
- 無調整豆乳 200ml
- 卵 1個
- ねぎ 少々
- 塩 少々、醤油数滴（お好みで）
作り方：
1. 鍋に豆乳を入れて温め、オートミールを加える。
2. とろみが出るまで弱火で煮る（約3〜5分）。
3. 火を弱めて卵を溶き入れ、半熟に仕上げる。
4. ねぎを散らし、塩や醤油で味を調える。
ポイント：オートミールの食物繊維と豆乳のたんぱく質で満腹感が続く。温かい食事は満足感を高める。`,
`こんにゃくヌードルのきのこスープ
材料（1人分）：
- こんにゃく麺 1袋（下茹で済みのもの）
- しめじ 100g、えのき 50g（お好みのきのこ）
- だし 300ml（鶏だしや昆布だし）
- 醤油 小さじ1、みりん 小さじ1（お好みで）
- 青ねぎ 少々
作り方：
1. 鍋にだしを温め、きのこを入れて煮る。
2. こんにゃく麺を加え、味を調える。
3. 器に盛り、青ねぎを散らす。
ポイント：こんにゃく麺は低カロリーでかさ増しに最適。スープで満腹感を得やすい。`,
`おからとほうれん草のヘルシーハンバーグ
材料（2〜3個分）：
- おからパウダー 50g（または生おから 100g）
- 卵 1個
- ほうれん草 1束（茹でて刻む）
- 玉ねぎ 1/4個（みじん切り）
- 塩胡椒 少々、片栗粉 小さじ1（つなぎ）
作り方：
1. ボウルにおからパウダー、卵、刻んだほうれん草、玉ねぎ、塩胡椒、片栗粉を入れてよく混ぜる。
2. 形を整えてフライパンで弱火〜中火で両面を焼く（焦げないように注意）。
3. 中まで火が通ったら完成。お好みでポン酢や低カロリーソースで。
ポイント：低脂質で食物繊維が豊富。噛みごたえがあり満足感が高い。`,
`アボカドとツナのレモン和え
材料（1人分）：
- アボカド 1/2個
- ツナ缶（ノンオイル）1/2缶
- レモン汁 小さじ1
- 黒胡椒 少々、刻みパセリ（お好みで）
作り方：
1. アボカドは皮をむき一口大に切る。
2. ツナは油を切り、アボカドと和える。
3. レモン汁と黒胡椒で味を調える。パセリを散らす。
ポイント：良質な脂質で満腹感が得られる。少量でも満足度が高い。`,
`サーモンとほうれん草のレモングリルボウル
材料（1人分）：
- 生鮭切り身 80g
- ほうれん草 80g
- ミニトマト 4個
- レモン汁 小さじ1
- オリーブオイル 小さじ1、塩胡椒 少々
作り方：
- 鮭に塩胡椒を振り、レモン汁とオリーブオイルをかけて下味をつける。
- フライパンまたはグリルで中火で両面を焼き、火が通ったら取り出す。
- ほうれん草はさっと茹でて水気を切る。ミニトマトは半分に切る。
- 器にほうれん草、トマト、鮭を盛り付け、好みで黒胡椒を振る。
ポイント：良質な脂質とタンパク質で満腹感が持続。レモンでさっぱり食べられる。`,
`レンズ豆と野菜のスパイシースープ
材料（1人分）：
- レンズ豆（乾燥）40g（茹でておく）
- にんじん 50g（角切り）
- 玉ねぎ 1/4個（みじん切り）
- トマト缶 100g（またはカットトマト）
- チキンブロスまたは水 300ml、クミン 小さじ1、塩胡椒 少々
作り方：
- 鍋に油少々を熱し、玉ねぎとにんじんを炒める。
- トマトとブロスを加え、煮立たせる。
- 茹でたレンズ豆とクミンを加え、弱火で10分ほど煮る。
- 塩胡椒で味を調え、器に盛る。
ポイント：レンズ豆の食物繊維とタンパク質で満腹感が長続き。スープで満足度アップ。`,
`ギリシャヨーグルトとベリーのプロテインパフェ
材料（1人分）：
- 無糖ギリシャヨーグルト 150g
- 冷凍ベリー（ミックス）70g（解凍）
- オートミール 15g（ローストしておく）
- はちみつ 小さじ1（お好みで）
作り方：
- 器にギリシャヨーグルトを入れる。
- ベリーを上にのせ、オートミールを散らす。
- 甘みが欲しければはちみつをかける。
- 全体を軽く混ぜて食べる。
ポイント：高タンパクで低脂肪。冷たい食感と酸味が満足感を高める。`,
`豆腐とアボカドの和風サラダ
材料（1人分）：
- 絹ごし豆腐 150g（軽く水切り）
- アボカド 1/2個
- きゅうり 1/2本（薄切り）
- ぽん酢 大さじ1、刻みねぎ 少々、白ごま 少々
作り方：
- 豆腐は一口大に切り、アボカドは角切りにする。
- きゅうりを薄切りにして水気を切る。
- 全てを器に盛り、ぽん酢をかける。
- ねぎと白ごまを散らして完成。
ポイント：豆腐のたんぱく質とアボカドの良質な脂で満腹感が得られる。和風でさっぱり。`,
`ターキーとズッキーニのミートボールとズッキーニヌードル
材料（1人分）：
- 挽きターキー（または鶏挽肉）100g
- ズッキーニ 1本（ヌードル状にする）
- 卵 1/2個、パン粉 大さじ1、塩胡椒 少々、にんにく 1片（みじん切り）
- トマトソース 100g（低糖）
作り方：
- ボウルに挽き肉、卵、パン粉、にんにく、塩胡椒を混ぜて小さなミートボールを作る。
- フライパンでミートボールを焼き、火が通ったら一旦取り出す。
- 同じフライパンでズッキーニヌードルをさっと炒め、トマトソースとミートボールを戻して絡める。
- 器に盛り付ける。
ポイント：低糖質でタンパク質が豊富。ズッキーニでかさ増しし満腹感を得る。`,
`ひよこ豆とトマトのサラダ（ファラフェル風）
材料（1人分）：
- ひよこ豆（水煮）100g
- きゅうり 1/2本、トマト 1個、赤玉ねぎ 少々（薄切り）
- レモン汁 小さじ1、オリーブオイル 小さじ1、クミン 少々、塩胡椒
作り方：
- ひよこ豆の半量を粗く潰し、残りはそのまま使う。
- きゅうり、トマト、玉ねぎと合わせ、レモン汁、オリーブオイル、クミンで和える。
- 味を見て塩胡椒で調整する。
- 器に盛り付ける。
ポイント：ひよこ豆の食物繊維とタンパク質で満腹感が続く。噛みごたえが満足感を高める。`,
`キャベツと鶏ささみのピリ辛ナムル
材料（1人分）：
- キャベツ 150g（千切り）
- 鶏ささみ 80g（茹でて裂く）
- にんにく 1/2片（すりおろし）、ごま油 小さじ1、醤油 小さじ1、豆板醤 小さじ1/2（お好みで）
作り方：
- キャベツはさっと茹でて水気を切る。
- 鶏ささみは茹でて裂いておく。
- 調味料を混ぜ合わせ、キャベツと鶏肉を和える。
- 最後に白ごまを振る。
ポイント：低カロリーで食物繊維が豊富。ピリ辛で満足感が増す。`,
`キヌアと枝豆の彩りサラダ
材料（1人分）：
- キヌア（炊いたもの）50g
- 枝豆（さやから出したもの）60g
- パプリカ 1/4個（角切り）、レモン汁 小さじ1、オリーブオイル 小さじ1、塩胡椒 少々
作り方：
- キヌアは炊いて冷ます。枝豆は茹でてさやから出す。
- 全ての材料をボウルで和える。
- レモン汁とオリーブオイルで味を調える。
- 器に盛り付ける。
ポイント：キヌアと枝豆で良質なタンパク質と食物繊維。満腹感が持続する。`,
`さばの塩焼きと大根おろしの和定食風
材料（1人分）：
- さば切り身 1切れ（約100g）
- 大根おろし 100g、レモンまたはすだち 少々、醤油 少々
作り方：
- さばに軽く塩を振り、グリルまたはフライパンで皮目から中火で焼く。
- 両面に焼き色がつき中まで火が通ったら取り出す。
- 大根をおろし、軽く水気を切る。
- 皿にさばと大根おろしを盛り、醤油とレモンを添える。
ポイント：青魚の良質な脂とタンパク質で満腹感。大根おろしでさっぱり食べられる。`,
`かぼちゃとレンズ豆のココナッツカレー（低脂肪）
材料（1人分）：
- かぼちゃ 100g（角切り）
- レンズ豆（茹で）50g、玉ねぎ 1/4個、にんにく 少々、カレー粉 小さじ1、ココナッツミルク 100ml（低脂肪可）
作り方：
- 鍋で玉ねぎとにんにくを炒め、かぼちゃを加える。
- カレー粉を加えて香りを出し、ココナッツミルクとブロスを注ぐ。
- かぼちゃが柔らかくなったらレンズ豆を加え、塩で味を調える。
- 器に盛り付ける。
ポイント：かぼちゃの甘みと豆の食物繊維で満腹感。スパイスで満足度アップ。`,
`オートミールとバナナの焼きパンケーキ（卵使用）
材料（1人分）：
- オートミール 40g（粉状にしても可）
- バナナ 1/2本（潰す）
- 卵 1個、ベーキングパウダー 小さじ1/4、シナモン 少々
作り方：
- ボウルでオートミール、潰したバナナ、卵、ベーキングパウダー、シナモンを混ぜる。
- フライパンに薄く油を敷き、中火で両面を焼く。
- 焼き上がったら皿に盛る。
- お好みでヨーグルトやベリーを添える。
ポイント：オートミールと卵で満腹感が続く。甘さはバナナで自然に。`,
`もやしと豆腐の中華風あんかけ
材料（1人分）：
- もやし 150g、絹ごし豆腐 150g、にんじん 少々（千切り）
- 鶏ガラスープ 250ml、醤油 小さじ1、片栗粉 小さじ1（同量の水で溶く）、ごま油 少々
作り方：
- 鍋にスープを温め、にんじんともやしをさっと煮る。
- 豆腐を一口大に切り加える。
- 醤油で味を整え、片栗粉でとろみをつける。
- 最後にごま油を垂らして香り付けする。
ポイント：低カロリーでかさ増し効果が高い。とろみで満腹感が得られる。`,
`鶏レバーと玉ねぎの低脂肪ソテー（鉄分補給）
材料（1人分）：
- 鶏レバー 80g（下処理済み）
- 玉ねぎ 1/2個（薄切り）
- にんにく 1片（みじん切り）、塩胡椒 少々、レモン汁 少々
作り方：
- レバーは血合いを取り一口大に切り、牛乳または水で軽く洗って水気を切る。
- フライパンに油少々を熱し、にんにくと玉ねぎを炒める。
- レバーを加え中火で火を通す。塩胡椒で味を調える。
- 仕上げにレモン汁をかける。
ポイント：鉄分とタンパク質が豊富で満腹感をサポート。低脂肪調理でヘルシー。`,
`海藻ときゅうりのさっぱり酢の物
材料（1人分）：
- 乾燥わかめ 5g（戻す）
- きゅうり 1本（薄切り）
- 酢 大さじ1、醤油 小さじ1、みりん 小さじ1、白ごま 少々
作り方：
- わかめを戻して水気を切る。きゅうりは薄切りにして塩少々で軽く揉み水気を絞る。
- 調味料を混ぜ合わせ、わかめときゅうりを和える。
- 器に盛り白ごまを振る。
- 冷やして食べるとよりさっぱり。
ポイント：低カロリーでかさがあり満腹感を得やすい。ミネラル補給にも良い。`,
`カッテージチーズとトマトのオープンサンド（ライ麦パン）
材料（1人分）：
- ライ麦パン 1枚（薄切り）
- カッテージチーズ 80g、トマト スライス2枚、黒胡椒 少々、バジル数枚
作り方：
- パンを軽くトーストする。
- カッテージチーズを塗り、トマトをのせる。
- 黒胡椒とバジルを散らす。
- 半分に切って食べる。
ポイント：高タンパクで満腹感が得られる。パンの食べ応えで満足度アップ。`,
`焼きりんごとシナモンのオートミールボウル
材料（1人分）：
- りんご 1/2個（薄切り）
- オートミール 30g、無糖アーモンドミルク 150ml、シナモン 少々、ナッツ少々（刻む）
作り方：
- 耐熱容器にりんごを並べ、シナモンを振って電子レンジで約2分加熱する。
- 鍋でアーモンドミルクを温めオートミールを加えとろみが出るまで煮る。
- 器にオートミールを盛り、焼きりんごとナッツをのせる。
- お好みで少量のはちみつをかける。
ポイント：温かいオートミールと果物の組み合わせで満腹感と満足感が高い。`,
`鶏むね肉のピリ辛ヨーグルトマリネボウル
材料（1人分）：
- 鶏むね肉 100g
- 無糖プレーンヨーグルト 大さじ3
- にんにく 1/2片（すりおろし）
- レタス 50g、きゅうり 1/2本、パプリカ 1/4個
- チリパウダー 少々、塩胡椒 少々
作り方：
- 鶏むね肉を一口大に切り、ヨーグルト、にんにく、チリパウダー、塩胡椒で30分以上マリネする。
- フライパンで中火で焼き、火が通ったら取り出す。
- 野菜を盛ったボウルに鶏肉をのせる。
- マリネ液を少量かけて仕上げる。
ポイント：ヨーグルトのタンパク質で柔らかく、スパイスで満足感が増す。`,
`豆腐とひじきの和風ハンバーグ
材料（2個分）：
- 木綿豆腐 150g（水切り）
- 乾燥ひじき 5g（戻して刻む）
- 卵 1/2個、片栗粉 大さじ1、ねぎ 少々、塩胡椒 少々
作り方：
- 豆腐は水気を切り、ボウルで潰す。ひじき、卵、片栗粉、ねぎ、塩胡椒を混ぜる。
- 形を整え、フライパンで両面を焼く（弱火でじっくり）。
- 中まで火が通ったら皿に盛る。お好みでポン酢をかける。
ポイント：低カロリーでかさがあり、噛むほど満足感が得られる。`,
`サバ缶とキャベツのトマト煮込み
材料（1人分）：
- サバ水煮缶 1缶（約100g）
- キャベツ 150g（ざく切り）
- カットトマト缶 100g、にんにく 1片、オリーブオイル 小さじ1、塩胡椒 少々
作り方：
- 鍋にオリーブオイルとにんにくを熱し、キャベツを炒める。
- トマト缶とサバを加え、弱火で10分ほど煮る。
- 塩胡椒で味を整え器に盛る。
ポイント：缶詰の良質な脂と野菜のボリュームで満腹感が続く。`,
`カリフラワーライスのチキン炒め
材料（1人分）：
- カリフラワーライス 150g（市販またはフードプロセッサーで作る）
- 鶏ももまたは胸肉 80g（小さめに切る）
- ピーマン 1/2個、玉ねぎ 1/4個、醤油 小さじ1、オイスターソース 小さじ1/2、胡椒 少々
作り方：
- フライパンで鶏肉を炒め、色が変わったら玉ねぎとピーマンを加える。
- カリフラワーライスを加え、調味料で炒め合わせる。
- 全体に火が通ったら器に盛る。
ポイント：低糖質でかさ増し効果が高く、満腹感を得やすい。`,
`エビとアスパラのレモンガーリック蒸し
材料（1人分）：
- むきエビ 100g
- アスパラガス 4本、にんにく 1片（薄切り）
- レモン汁 小さじ1、オリーブオイル 小さじ1、塩胡椒 少々
作り方：
- 耐熱皿にエビ、アスパラ、にんにくを並べ、オリーブオイルとレモン汁、塩胡椒をかける。
- ラップをして電子レンジで約2〜3分加熱する（エビに火が通るまで）。
- 器に盛り、レモンを添える。
ポイント：低カロリーでタンパク質が豊富。さっぱりして満腹感が得られる。`,
`豆乳とほうれん草のグリーンスムージー（朝食代替）
材料（1人分）：
- 無調整豆乳 200ml、ほうれん草 1束（茹でて冷ます）
- バナナ 1/2本、プロテインパウダー（無糖）大さじ1、氷適量
作り方：
- 全ての材料をブレンダーに入れて滑らかになるまで撹拌する。
- グラスに注いで飲む。
ポイント：液体でもタンパク質と食物繊維で満腹感が続く。朝食代わりに最適。`,
`牛ひき肉と豆のピリ辛チリコンカン（低脂肪）
材料（1人分）：
- 牛または合挽き肉 80g（脂少なめ）
- ミックスビーンズ 80g（缶詰水切り）
- 玉ねぎ 1/4個、トマト缶 100g、チリパウダー 小さじ1、塩胡椒 少々
作り方：
- フライパンで玉ねぎと挽き肉を炒め、色が変わったらトマト缶を加える。
- ビーンズとチリパウダーを加え、弱火で10分煮る。
- 塩胡椒で味を整え器に盛る。
ポイント：豆と肉の組合せで満腹感と満足度が高い。`,
`焼きなすと鶏ささみの胡麻だれ和え
材料（1人分）：
- なす 1本、鶏ささみ 80g（茹でて裂く）
- すりごま 大さじ1、醤油 小さじ1、酢 小さじ1、みりん 小さじ1/2
作り方：
- なすを焼いて皮をむき、一口大に裂く。
- すりごま、醤油、酢、みりんを混ぜてタレを作る。
- なすと鶏ささみを和えて器に盛る。
ポイント：なすのボリュームと鶏のタンパク質で満腹感が得られる。`,
`そば粉のガレット風卵包み（そば使用）
材料（1人分）：
- そば粉 40g、水 60ml、卵 1個、ほうれん草 50g、ハムまたはサーモン少々、塩胡椒 少々
作り方：
- そば粉と水を混ぜて生地を作り、フライパンで薄く焼く。
- ほうれん草を炒めて塩胡椒し、ガレットの中央にのせる。
- 卵を割り入れ、端を折りたたんで包む。
- 仕上げにハムやサーモンを添える。
ポイント：そば粉は満腹感が得やすく、低GIでダイエット向き。`,
`豆腐とキムチのピリ辛スープ（発酵食品で満足）
材料（1人分）：
- 絹ごし豆腐 150g、キムチ 50g、だし 300ml、ねぎ 少々、ごま油 小さじ1/2
作り方：
- 鍋にだしを温め、キムチを入れて煮る。
- 豆腐を一口大に切って加え、温める。
- 器に盛り、ねぎとごま油を垂らす。
ポイント：発酵食品の風味で満足感が高く、低カロリーでかさ増し。`,
`サーモン缶とアボカドのライム和えトースト（全粒粉）
材料（1人分）：
- 全粒粉パン 1枚、サーモン缶（水煮）80g、アボカド 1/2個、ライム汁 小さじ1、黒胡椒 少々
作り方：
- パンをトーストし、アボカドを潰してライム汁を混ぜる。
- トーストにアボカドを塗り、サーモンをのせる。
- 黒胡椒を振って完成。
ポイント：良質な脂とタンパク質で満腹感が得られる。`,
`ズッキーニとマッシュルームのバルサミコソテー
材料（1人分）：
- ズッキーニ 1本、マッシュルーム 80g、にんにく 1片、バルサミコ酢 小さじ1、オリーブオイル 小さじ1、塩胡椒 少々
作り方：
- フライパンでにんにくを炒め、ズッキーニとマッシュルームを加えて炒める。
- 火が通ったらバルサミコ酢を回しかけ、塩胡椒で調整する。
- 器に盛る。
ポイント：低カロリーで食物繊維が豊富。満腹感を得やすい副菜。`,
`鶏むね肉の梅しそロール（焼き）
材料（1人分）：
- 鶏むね肉 120g（薄く開く）
- 梅干し 1個（種を除き叩く）、大葉 2枚、塩胡椒 少々、片栗粉 少々
作り方：
- 鶏肉を薄く開き、梅ペーストと大葉をのせて巻く。
- 片栗粉を薄くまぶし、フライパンで転がしながら焼く。
- 中まで火が通ったら切って盛る。
ポイント：梅の酸味で満足感が高く、低脂質で満腹感を得られる。`,
`白身魚と白菜の酒蒸し（和風）
材料（1人分）：
- 白身魚切り身 100g、白菜 100g、しいたけ 2枚、酒 大さじ1、塩少々、ポン酢適量
作り方：
- 耐熱皿に白菜、しいたけを敷き、魚をのせて酒を振る。
- ラップをして電子レンジで約3〜4分加熱する（魚の厚さで調整）。
- 器に盛り、ポン酢でいただく。
ポイント：蒸し料理は満足感が高く低カロリー。野菜のかさで満腹感アップ。`,
`レンズ豆とほうれん草のサラダ（温）
材料（1人分）：
- レンズ豆（茹で）60g、ほうれん草 80g、赤パプリカ 少々、オリーブオイル 小さじ1、レモン汁 小さじ1、塩胡椒 少々
作り方：
- レンズ豆を温め、ほうれん草はさっと茹でる。
- 全てをボウルで和え、オリーブオイルとレモン汁で味を調える。
- 器に盛る。
ポイント：豆の食物繊維と葉物の組合せで満腹感が持続する。`,
`鶏そぼろと大根のヘルシー丼（糖質控えめ）
材料（1人分）：
- 鶏ひき肉 100g、だし 50ml、醤油 小さじ1、みりん 小さじ1、砂糖少々（または代替甘味料）
- 大根 150g（千切りまたは短冊）
作り方：
- フライパンで鶏ひき肉を炒め、だしと調味料を加えてそぼろにする。
- 大根は千切りにして軽く塩もみし、水気を切る。
- 器に大根を敷き、鶏そぼろをのせる。
ポイント：ご飯の代わりに大根でかさ増し。タンパク質で満腹感を維持。`,
`きのこと豆のミネストローネ（野菜たっぷり）
材料（1人分）：
- しめじ 50g、マッシュルーム 50g、ミックスビーンズ 80g、玉ねぎ 1/4個、トマト缶 100g、ブロス 300ml、塩胡椒 少々
作り方：
- 鍋で玉ねぎときのこを炒め、トマト缶とブロスを加える。
- ビーンズを加え、弱火で10分煮る。
- 塩胡椒で味を整え器に盛る。
ポイント：野菜と豆でかさがあり満腹感が続く。スープで満足度アップ。`,
`オートミールとツナのサラダコロッケ（焼き）
材料（4個分）：
- オートミール 50g、ツナ缶（ノンオイル）80g、卵 1個、玉ねぎ 1/4個（みじん切り）、塩胡椒 少々、パン粉 少々（衣）
作り方：
- ボウルでオートミール、ツナ、玉ねぎ、卵、塩胡椒を混ぜて形を作る。
- パン粉を薄くつけてオーブンまたはフライパンで焼く（揚げずに焼く）。
- 焼き色がついたら取り出す。
ポイント：オートミールでかさ増し、焼き調理で低脂肪。満腹感が得られる。`,
`ほたてとブロッコリーの中華風蒸し物
材料（1人分）：
- ほたて貝柱（冷凍可）80g、ブロッコリー 100g、しょうが 少々、醤油 小さじ1、ごま油 小さじ1/2、酒 小さじ1
作り方：
- 耐熱皿にブロッコリーとほたてを並べ、酒を振る。
- ラップをして電子レンジで約2〜3分加熱する。
- 仕上げに醤油とごま油、刻みしょうがをかける。
ポイント：高タンパクで低カロリー。海鮮の旨味で満足感が高い。`,
`豆腐とオクラの冷やしネバネバ丼（夏向け）
材料（1人分）：
- 絹ごし豆腐 150g、オクラ 4本（茹でて輪切り）、めかぶ 50g、めんつゆ（希釈）大さじ1、刻みねぎ 少々
作り方：
- 豆腐を一口大に切り、器に盛る。
- オクラとめかぶをのせ、めんつゆをかける。
- ねぎを散らして完成。
ポイント：ネバネバ食材で満足感があり、低カロリーで満腹感を維持。`,
`豆腐スクランブルと彩り野菜のプレート
材料（1人分）：
- 絹ごし豆腐 150g（軽く水切り）
- パプリカ 1/4個、ほうれん草 50g、玉ねぎ 1/8個（みじん切り）
- ターメリック 小さじ1/4、塩胡椒 少々、オリーブオイル 小さじ1
作り方：
- フライパンに油を熱し玉ねぎを炒める。
- ほぐした豆腐とターメリックを加え、水分を飛ばすように炒める。
- パプリカとほうれん草を加えてさっと炒め、塩胡椒で調える。
- 皿に盛り付ける。
ポイント：卵不使用でも満足感のあるタンパク源。香辛料で風味を出し満腹感を高める。`,
`しらたきと鶏ひき肉のピリ辛炒め
材料（1人分）：
- しらたき 150g（下茹でして水切り）
- 鶏ひき肉 80g、長ねぎ 1/4本、にんにく 1/2片、豆板醤 小さじ1/2、醤油 小さじ1
作り方：
- フライパンでにんにくと長ねぎを炒め、鶏ひき肉を加える。
- 肉に火が通ったらしらたきを加え、豆板醤と醤油で味付けする。
- 水分が飛ぶまで炒め合わせて器に盛る。
ポイント：低カロリーでかさ増し。ピリ辛で満足感が得られる。`,
`なすの味噌チーズ焼き（低脂肪）
材料（1人分）：
- なす 1本、味噌 大さじ1/2、みりん 小さじ1、粉チーズ 小さじ1（控えめ）
作り方：
- なすを縦半分に切り、切り目を入れてオーブントースターで下焼きする。
- 味噌とみりんを混ぜて塗り、粉チーズを振る。
- 再度焼き色がつくまで焼いて完成。
ポイント：チーズのコクで満足感を出しつつ低脂肪に抑える。`,
`グレープフルーツと鶏ささみのさっぱりサラダ
材料（1人分）：
- 鶏ささみ 80g（茹でて裂く）、グレープフルーツ 1/2個、ベビーリーフ 30g、オリーブオイル 小さじ1、塩胡椒 少々
作り方：
- ささみを茹でて裂き、グレープフルーツは果肉を取り出す。
- ベビーリーフと合わせ、オリーブオイルと塩胡椒で和える。
- 器に盛り付ける。
ポイント：柑橘の酸味で満足感が高まり、低カロリーで満腹感を維持。`,
`ターキーとレタスのヘルシーラップ（低糖質）
材料（1人分）：
- ターキー薄切りまたは鶏ハム 80g、レタス 3枚、アボカド 1/4個、マスタード 小さじ1、黒胡椒 少々
作り方：
- レタスを広げ、ターキー、スライスしたアボカドをのせる。
- マスタードと黒胡椒をかけて巻く。
- 食べやすく切って盛る。
ポイント：パンを使わずかさ増し。良質なタンパク質と脂で満腹感が続く。`,
`そばの冷製サラダ　ごまドレッシング
材料（1人分）：
- そば（茹で）80g、きゅうり 1/2本、ミニトマト 4個、茹で卵 1/2個、すりごま 大さじ1、醤油 小さじ1、酢 小さじ1
作り方：
- そばを茹でて冷水で締める。
- 野菜と卵を切り、そばと合わせる。
- すりごま、醤油、酢で和えて器に盛る。
ポイント：そばの満腹感と低GIでダイエット向き。ごまで満足度アップ。`,
`かぼちゃとギリシャヨーグルトのクリーミースープ
材料（1人分）：
- かぼちゃ 150g、玉ねぎ 1/8個、チキンブロス 300ml、無糖ギリシャヨーグルト 大さじ2、塩胡椒 少々
作り方：
- 鍋で玉ねぎとかぼちゃを炒め、ブロスを加えて柔らかく煮る。
- ブレンダーで滑らかにし、再度温めてヨーグルトを混ぜる。
- 塩胡椒で味を調える。
ポイント：クリーミーでも低脂肪。満腹感が続く温かい一品。`,
`まぐろのたたきと大根の和風サラダ
材料（1人分）：
- まぐろ（刺身用）80g、大根 100g（千切り）、青じそ 2枚、ポン酢 大さじ1、ごま 少々
作り方：
- まぐろを軽く炙って叩き、食べやすく切る。
- 大根と合わせ、ポン酢で和える。
- 青じそとごまを散らして盛る。
ポイント：高タンパクで低カロリー。大根のかさで満腹感を得やすい。`,
`きのことほうれん草のふんわりオムレツ（卵2個）
材料（1人分）：
- 卵 2個、しめじ 50g、ほうれん草 50g、塩胡椒 少々、オリーブオイル 小さじ1
作り方：
- きのことほうれん草を炒めて塩胡椒する。
- 溶き卵を流し入れ、ふんわりと焼き上げる。
- 皿に盛る。
ポイント：卵の満足感と野菜のかさで満腹感が続く。`,
`カリフラワーとひよこ豆のスパイスカレー（低脂肪）
材料（1人分）：
- カリフラワー 150g、ひよこ豆（水煮）80g、玉ねぎ 1/8個、カレー粉 小さじ1、トマト缶 80g、塩少々
作り方：
- 玉ねぎを炒め、カレー粉を加えて香りを出す。
- カリフラワーとトマト、ひよこ豆を加え煮る。
- 塩で味を調えて器に盛る。
ポイント：野菜と豆でかさ増し。スパイスで満足感を高める。`,
`しらすと大葉の冷やし豆腐丼（簡単）
材料（1人分）：
- 絹ごし豆腐 150g、しらす干し 大さじ2、大葉 3枚、めんつゆ（希釈）大さじ1、白ごま 少々
作り方：
- 豆腐を器に盛り、しらすと刻んだ大葉をのせる。
- めんつゆをかけてごまを振る。
- 冷やして食べる。
ポイント：超低カロリーでタンパク質補給。満腹感は豆腐のボリュームで。`,
`オートミールとほうれん草のチーズ焼き（朝食）
材料（1人分）：
- オートミール 40g、ほうれん草 50g、卵 1個、粉チーズ 小さじ1、塩胡椒 少々
作り方：
- ボウルで全材料を混ぜ、耐熱容器に入れる。
- オーブントースターで表面に焼き色がつくまで焼く（約8〜10分）。
- 取り出して切り分ける。
ポイント：オートミールでかさ増し、焼くことで満足感が高まる。`,
`白身魚のレモンハーブ蒸しとブロッコリー
材料（1人分）：
- 白身魚切り身 100g、ブロッコリー 100g、レモン薄切り 2枚、ハーブ（タイム等）少々、塩胡椒 少々
作り方：
- 耐熱皿に魚とブロッコリーを並べ、レモンとハーブをのせる。
- ラップをして電子レンジで約3〜4分加熱する。
- 塩胡椒で調えて盛る。
ポイント：蒸し料理で低カロリー。ハーブとレモンで満足感を演出。`,
`レンズ豆のスパイシーバーガー（レタス包み）
材料（1人分）：
- レンズ豆（茹で）80g、玉ねぎ 1/8個、パン粉 大さじ1、卵 1/2個、クミン 少々、レタス数枚
作り方：
- レンズ豆を潰して玉ねぎ、パン粉、卵、クミンを混ぜてパティを作る。
- フライパンで両面を焼き、レタスで包んで食べる。
- お好みでトマトを添える。
ポイント：植物性タンパクで満腹感。パンを使わず糖質を抑える。`,
`鶏むね肉のバジルヨーグルトソース和え
材料（1人分）：
- 鶏むね肉 100g、無糖ヨーグルト 大さじ2、刻みバジル 小さじ1、レモン汁 小さじ1、塩胡椒 少々
作り方：
- 鶏むね肉を茹でて裂く。
- ヨーグルト、バジル、レモン汁、塩胡椒を混ぜソースを作る。
- 鶏肉と和えて器に盛る。
ポイント：ヨーグルトで低脂肪ながらコクがあり満腹感を維持。`,
`きのこと豆腐のヘルシーグラタン（オーブン焼き）
材料（1人分）：
- 絹ごし豆腐 150g、しめじ 70g、トマトソース 60g、粉チーズ 小さじ1、黒胡椒 少々
作り方：
- 耐熱皿に豆腐を崩して入れ、きのことトマトソースをのせる。
- 粉チーズを振りオーブンまたはトースターで焼き色をつける。
- 取り出して黒胡椒を振る。
ポイント：クリーミー感を豆腐で出しつつ低カロリー。満腹感が得られる一皿。`,
`オクラと納豆のネバネバサラダ（発酵×食物繊維）
材料（1人分）：
- オクラ 4本（茹でて輪切り）、納豆 1パック、刻みねぎ 少々、醤油 小さじ1/2、すりごま 小さじ1
作り方：
- オクラと納豆を混ぜ、ねぎと調味料を加える。
- すりごまを振って器に盛る。
ポイント：ネバネバ食材で満足感が高く、低カロリーで腹持ちが良い。`,
`大麦と野菜のヘルシーピラフ（食物繊維重視）
材料（1人分）：
- 大麦（炊いたもの）80g、玉ねぎ 1/8個、にんじん 30g、ピーマン 1/4個、チキンブロス 100ml、塩胡椒 少々
作り方：
- 玉ねぎと野菜を炒め、大麦とブロスを加えて水分を飛ばすように炒め煮する。
- 塩胡椒で味を整え器に盛る。
ポイント：大麦の食物繊維で満腹感が長続き。ご飯代わりに最適。`,
`プロテインチアプディング（夜食にも）
材料（1人分）：
- チアシード 大さじ1、無調整豆乳 150ml、プロテインパウダー（無糖）大さじ1、ベリー少々
作り方：
- 容器にチアシード、豆乳、プロテインを入れてよく混ぜる。
- 冷蔵庫で最低30分〜一晩置く。
- ベリーをのせて食べる。
ポイント：液体でも満腹感が続く。タンパク質と食物繊維で腹持ち良好。`,
`ほうれん草とフェタのミニキッシュ（卵1個）
材料（1人分）：
- 卵 1個、ほうれん草 50g、フェタチーズ 20g、玉ねぎ 少々、塩胡椒 少々
作り方：
- 小さな耐熱容器に炒めたほうれん草と玉ねぎを入れる。
- 卵を溶いて注ぎ、フェタを散らす。
- トースターで約8〜10分焼く。
ポイント：少量でも満足感が高い。タンパク質と風味で満腹感を演出。`,
`海藻と豆腐のあっさり味噌汁（具だくさん）
材料（1人分）：
- 絹ごし豆腐 100g、乾燥わかめ 5g、しめじ 50g、味噌 大さじ1、だし 300ml、ねぎ 少々
作り方：
- だしを温め、きのこと豆腐を加えて煮る。
- 味噌を溶き入れ、わかめとねぎを加えて火を止める。
- 器に盛る。
ポイント：汁物で満腹感を得やすく、具だくさんで満足度が高い。`,
`豆腐ステーキ きのこポン酢ソース
材料（1人分）：
- 木綿豆腐 150g（しっかり水切り）
- しめじ 50g、えのき 50g
- ポン酢 大さじ1、みりん 小さじ1、刻みねぎ 少々、サラダ油 小さじ1
作り方：
- 豆腐は厚さを半分に切り、キッチンペーパーで水気を取る。
- フライパンに油を熱し、豆腐を両面こんがり焼く。
- 別のフライパンできのこを炒め、みりんを加えてアルコールを飛ばす。
- ポン酢を加えて軽く煮詰め、豆腐にかけてねぎを散らす。
ポイント：豆腐で高タンパク低脂肪。きのこの旨味で満足感が得られる。`,
`ささみの梅おろしサラダ
材料（1人分）：
- 鶏ささみ 100g、梅干し 1個、大根おろし 100g、ベビーリーフ 30g、ポン酢 小さじ2
作り方：
- ささみを茹でて裂く。
- 梅干しは種を取り叩いておく。
- 器にベビーリーフ、ささみ、大根おろしを盛り、梅を混ぜたポン酢をかける。
ポイント：酸味で満足感が高く、低カロリーで腹持ちが良い。`,
`玄米と枝豆の和風サラダ
材料（1人分）：
- 玄米（炊いたもの）80g、枝豆（さや出し）60g、きゅうり 1/2本、白ごま 小さじ1、醤油 小さじ1、酢 小さじ1
作り方：
- 玄米と枝豆を温めて冷ます。
- きゅうりを薄切りにし、全てを混ぜる。
- 醤油と酢で和え、白ごまを振る。
ポイント：玄米の噛みごたえと枝豆のタンパク質で満腹感が続く。`,
`低脂肪ビーフとキャベツのにんにく炒め
材料（1人分）：
- 牛薄切り（脂少なめ）80g、キャベツ 150g、にんにく 1片、醤油 小さじ1、黒胡椒 少々、オリーブオイル 小さじ1
作り方：
- フライパンに油とにんにくを熱し、牛肉を炒める。
- 肉の色が変わったらキャベツを加え強火でさっと炒める。
- 醤油と黒胡椒で味を調えて器に盛る。
ポイント：肉の旨味で満足感が高く、野菜のかさで腹持ちが良い。`,
`ほたてとトマトのセビーチェ風（冷製）
材料（1人分）：
- ほたて貝柱（刺身用）80g、トマト 1個、玉ねぎ 少々、ライム汁 大さじ1、塩胡椒 少々、香菜（お好みで）少々
作り方：
- ほたては薄切り、トマトと玉ねぎは小さめに切る。
- 全てをボウルに入れライム汁と塩胡椒で和え、冷蔵庫で10分ほど冷やす。
- 器に盛り香菜を散らす。
ポイント：低カロリーでさっぱり。酸味と海鮮の旨味で満足感が得られる。`,
`さつまいもとレンズ豆のハーブサラダ
材料（1人分）：
- さつまいも 100g（蒸して角切り）、レンズ豆（茹で）50g、ルッコラ 20g、オリーブオイル 小さじ1、レモン汁 小さじ1、塩胡椒 少々、ローズマリー少々
作り方：
- 蒸したさつまいもと茹でたレンズ豆を冷ます。
- ルッコラと合わせ、オリーブオイルとレモン汁、刻んだローズマリーで和える。
- 塩胡椒で味を調える。
ポイント：さつまいもの甘みと豆の食物繊維で満腹感が持続する。`,
`低脂肪ヨーグルトチキンカレー（簡易）
材料（1人分）：
- 鶏むね肉 100g、無糖ヨーグルト 大さじ3、玉ねぎ 1/4個、カレー粉 小さじ1、トマトペースト 大さじ1、塩少々、オリーブオイル 小さじ1
作り方：
- 玉ねぎを炒め、鶏肉を加えて色が変わるまで炒める。
- カレー粉とトマトペーストを加え香りを出す。
- ヨーグルトを加えて弱火で煮込み、塩で調整する。
ポイント：ヨーグルトでコクを出しつつ低脂肪。タンパク質で満腹感が続く。`,
`ズッキーニボートのツナチーズ焼き（低糖質）
材料（1人分）：
- ズッキーニ 1本（縦半分に切り種を少し取り除く）、ツナ缶（ノンオイル）60g、トマトソース 大さじ1、粉チーズ 小さじ1、黒胡椒 少々
作り方：
- ズッキーニのくぼみにトマトソース、ツナを詰める。
- 粉チーズを振りトースターで焼き色がつくまで焼く（約8〜10分）。
- 黒胡椒を振って完成。
ポイント：見た目の満足感が高く、低糖質で腹持ちが良い。`,
`豆腐とアスパラのカレー風味炒め
材料（1人分）：
- 絹ごし豆腐 150g（軽く水切り）、アスパラ 4本、カレー粉 小さじ1/2、醤油 小さじ1、オリーブオイル 小さじ1
作り方：
- アスパラを炒め、豆腐を崩しながら加える。
- カレー粉と醤油で味を調え、軽く炒め合わせる。
- 器に盛る。
ポイント：スパイスで満足感を出しつつ低カロリーで腹持ち良好。`,
`サーモンとアボカドのライム和え（サラダ）
材料（1人分）：
- サーモン刺身用 80g、アボカド 1/2個、ライム汁 小さじ1、赤玉ねぎ 少々、黒胡椒 少々、ベビーリーフ 30g
作り方：
- サーモンとアボカドを一口大に切る。
- ライム汁と薄切り赤玉ねぎで和え、ベビーリーフに盛る。
- 黒胡椒を振る。
ポイント：良質な脂で満腹感が得られ、少量で満足度が高い。`,
`きのこと豆腐のピリ辛蒸し（レンジで簡単）
材料（1人分）：
- 絹ごし豆腐 150g、しめじ 70g、豆板醤 小さじ1/2、醤油 小さじ1、ごま油 小さじ1/2、ねぎ 少々
作り方：
- 耐熱皿に豆腐ときのこを入れ、豆板醤と醤油を回しかける。
- ラップをして電子レンジで約3分加熱する。
- ごま油とねぎを散らして完成。
ポイント：短時間で作れて満腹感が得られる。ピリ辛で満足度アップ。`,
`鶏むね肉のハーブグリルとロースト野菜
材料（1人分）：
- 鶏むね肉 120g、ズッキーニ 50g、パプリカ 1/4個、ローズマリーまたはタイム 少々、オリーブオイル 小さじ1、塩胡椒 少々
作り方：
- 鶏肉に塩胡椒とハーブを振り、オーブンまたはフライパンで焼く。
- 野菜は一口大に切り、オリーブオイルと塩でローストする。
- 皿に盛り合わせる。
ポイント：香りで満足感が高く、野菜のボリュームで腹持ちが良い。`,
`白身魚のトマトバジル煮（低脂肪）
材料（1人分）：
- 白身魚切り身 100g、トマト缶 100g、にんにく 1片、バジル数枚、塩胡椒 少々、オリーブオイル 小さじ1
作り方：
- 鍋にオリーブオイルとにんにくを熱し、トマト缶を加える。
- 魚を入れて弱火で煮込み、バジルを加える。
- 塩胡椒で味を調えて盛る。
ポイント：トマトの酸味で満足感があり、低脂肪でヘルシー。`,
`オートミールとほうれん草のスパニッシュトルティーヤ（小さめ）
材料（1人分）：
- オートミール 30g、卵 1個、ほうれん草 50g、玉ねぎ 少々、塩胡椒 少々、オリーブオイル 小さじ1
作り方：
- 玉ねぎとほうれん草を炒め、ボウルで卵とオートミールを混ぜる。
- フライパンで弱火でじっくり焼き、両面を返して火を通す。
- 切り分けて盛る。
ポイント：オートミールでかさ増し、卵で満腹感が続く。`,
`鶏レバーとほうれん草のガーリックソテー（鉄分補給）
材料（1人分）：
- 鶏レバー 80g、ほうれん草 80g、にんにく 1片、オリーブオイル 小さじ1、塩胡椒 少々、レモン汁 少々
作り方：
- レバーは下処理して一口大に切る。にんにくで香りを出しレバーを炒める。
- ほうれん草を加えてさっと炒め、塩胡椒で調える。
- 仕上げにレモン汁を垂らす。
ポイント：鉄分とタンパク質で満腹感と栄養補給を同時に。`,
`豆と野菜のメキシカンラップ（レタスor全粒トルティーヤ）
材料（1人分）：
- ミックスビーンズ 80g、トマト 1/2個、玉ねぎ 少々、コリアンダー（お好みで）少々、サルサソース 大さじ1、レタス数枚または全粒トルティーヤ1枚
作り方：
- 全ての具材を混ぜ、サルサで和える。
- レタスで包むかトルティーヤにのせて巻く。
- 食べやすく切って盛る。
ポイント：豆の食物繊維で腹持ち良好。スパイシーさで満足感が増す。`,
`焼きカブと鶏そぼろの和風マリネ
材料（1人分）：
- カブ 150g（くし切り）、鶏ひき肉 80g、だし 50ml、醤油 小さじ1、みりん 小さじ1、刻みねぎ 少々
作り方：
- カブをオーブンまたはフライパンで焼き色がつくまで焼く。
- 鶏ひき肉を炒め、だしと調味料でそぼろにする。
- 焼きカブにそぼろをのせてねぎを散らす。
ポイント：根菜の満足感とそぼろのタンパク質で腹持ちが良い。`,
`プロテイン入りベリークランブル（低脂肪焼き菓子）
材料（1人分）：
- 冷凍ベリー 80g、オートミール 30g、プロテインパウダー（無糖）大さじ1、はちみつ 小さじ1、ココナッツオイル 小さじ1（控えめ）
作り方：
- ベリーを耐熱容器に入れ、上にオートミールとプロテインを混ぜたクランブルをのせる。
- ココナッツオイルを少量垂らし、トースターで焼き色がつくまで焼く（約8〜10分）。
- 冷まし気味にして食べる。
ポイント：デザート感覚で満足感を得つつタンパク質を補給。`,
`春菊と豆腐のナムル風サラダ（香り高く）
材料（1人分）：
- 春菊 80g（さっと茹でて水気を切る）、絹ごし豆腐 100g、醤油 小さじ1、ごま油 小さじ1/2、すりごま 小さじ1
作り方：
- 春菊と豆腐を食べやすく切る。
- 醤油とごま油で和え、すりごまを振る。
- 器に盛る。
ポイント：香りの強い葉物で満足感が高く、低カロリーで腹持ちが良い。`

  ];

  // variants 配列に既存のサンプルと追加レシピを統合
  const variants = [
    sampleRecipe,
    `満腹感シーフードサラダ
材料：
- サラダミックス 100g
- サバ缶（オイル不使用）1缶
- もち麦ごはん 50g

作り方：
サラダと魚、もち麦を和えるだけ。プロテインと食物繊維で満腹感持続。`,
    `満腹スピードおからオムレツ
材料：おからパウダー 30g、卵 2個、ほうれん草 適量
作り方：全て混ぜてフライパンで焼く。低カロリーで腹持ち良し。`,
    // 追加5レシピを展開
    ...addedRecipes
  ];

  // 初期表示
  recipeTextEl.textContent = sampleRecipe;

  // 今日のレシピをランダムに切り替える
  todayBtn.addEventListener('click', () => {
    const idx = Math.floor(Math.random() * variants.length);
    recipeTextEl.textContent = variants[idx];
    flashFrame();
  });

  // 枠をフラッシュして視覚効果
  function flashFrame() {
    recipeFrame.classList.remove('flash');
    void recipeFrame.offsetWidth;
    recipeFrame.classList.add('flash');
  }

  // テキストをコピー（アクセシビリティとエラーハンドリング）
  copyBtn.addEventListener('click', async () => {
    const text = recipeTextEl.textContent || '';
    try {
      if (navigator.clipboard && navigator.clipboard.writeText) {
        await navigator.clipboard.writeText(text);
      } else {
        // フォールバック
        const ta = document.createElement('textarea');
        ta.value = text;
        ta.setAttribute('aria-hidden', 'true');
        ta.style.position = 'fixed';
        ta.style.left = '-9999px';
        document.body.appendChild(ta);
        ta.select();
        const ok = document.execCommand && document.execCommand('copy');
        ta.remove();
        if (!ok) throw new Error('execCommand copy failed');
      }
      showToast('レシピをコピーしました');
    } catch (e) {
      console.error('コピーに失敗しました', e);
      showToast('コピーに失敗しました');
    }
  });

  // PNGで保存（高DPI対応・自動折返し・エラーハンドリング）
  pngBtn.addEventListener('click', () => {
    const padding = 24;
    const baseFontSize = 16;
    const titleFontSize = 20;
    const lineHeight = 22;
    const text = recipeTextEl.textContent || '';
    const maxWidth = Math.min(window.innerWidth - 32, 1200);
    const dpr = window.devicePixelRatio || 1;

    // 仮のコンテキストで折返し計算
    const measureCanvas = document.createElement('canvas');
    const measureCtx = measureCanvas.getContext('2d');
    if (!measureCtx) {
      showToast('画像生成に失敗しました');
      return;
    }
    measureCtx.font = `${baseFontSize}px sans-serif`;
    const usableWidth = Math.max(400, maxWidth) - padding * 2;

    // テキストを段落ごとに折返し
    const lines = [];
    text.split('\n').forEach(paragraph => {
      const words = paragraph.split(' ');
      let line = '';
      words.forEach(word => {
        const test = line ? `${line} ${word}` : word;
        const metrics = measureCtx.measureText(test);
        if (metrics.width > usableWidth && line) {
          lines.push(line);
          line = word;
        } else {
          line = test;
        }
      });
      if (line) lines.push(line);
    });

    // キャンバスサイズ（高DPI対応）
    const width = Math.max(400, maxWidth);
    const height = padding * 2 + (lines.length + 2) * lineHeight + 40;

    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d');
    if (!ctx) {
      showToast('画像生成に失敗しました');
      return;
    }
    canvas.width = Math.round(width * dpr);
    canvas.height = Math.round(height * dpr);
    canvas.style.width = `${width}px`;
    canvas.style.height = `${height}px`;
    ctx.scale(dpr, dpr);

    // 背景
    ctx.fillStyle = '#fffef6';
    ctx.fillRect(0, 0, width, height);

    // タイトル
    ctx.fillStyle = '#ff6fa3';
    ctx.font = `bold ${titleFontSize}px sans-serif`;
    ctx.fillText('満腹感レシピ', padding, padding + 8);

    // 本文
    ctx.fillStyle = '#222';
    ctx.font = `${baseFontSize}px sans-serif`;
    let y = padding + 32;
    lines.forEach((line) => {
      ctx.fillText(line, padding, y);
      y += lineHeight;
    });

    // toBlob のサポート確認とダウンロード
    try {
      if (canvas.toBlob) {
        canvas.toBlob((blob) => {
          if (!blob) {
            showToast('画像生成に失敗しました');
            return;
          }
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = 'manpukurecipe.png';
          // a 要素を一時的に追加してクリック
          document.body.appendChild(a);
          a.click();
          a.remove();
          // revoke は少し遅らせる
          setTimeout(() => {
            try {
              URL.revokeObjectURL(url);
            } catch (e) {
              console.error('URL.revokeObjectURL failed', e);
            }
          }, 1000);
          showToast('画像をダウンロードしました');
        }, 'image/png');
      } else {
        // フォールバック: dataURL を使う
        const dataUrl = canvas.toDataURL('image/png');
        const a = document.createElement('a');
        a.href = dataUrl;
        a.download = 'manpukurecipe.png';
        document.body.appendChild(a);
        a.click();
        a.remove();
        showToast('画像をダウンロードしました');
      }
    } catch (e) {
      console.error('PNG生成エラー', e);
      showToast('画像生成に失敗しました');
    }
  });

  // ネイティブ共有
  nativeShareBtn.addEventListener('click', async () => {
    const title = '満腹感レシピ';
    const text = recipeTextEl.textContent || '';
    const url = location.href;
    if (navigator.share) {
      try {
        await navigator.share({ title, text, url });
      } catch (e) {
        console.error('ネイティブ共有キャンセルまたはエラー', e);
        showToast('共有がキャンセルされました');
      }
    } else {
      showToast('この端末はネイティブ共有に対応していません');
    }
  });

  // 各SNSシェア
  function openShare(url) {
    try {
      window.open(url, '_blank', 'noopener,noreferrer');
    } catch (e) {
      console.error('シェアウィンドウを開けませんでした', e);
      showToast('シェアに失敗しました');
    }
  }

  const pageTitle = encodeURIComponent(document.title);
  const pageUrl = encodeURIComponent(location.href);

  // ページテキストは長すぎると切られるため、短縮してエンコード
  function getShareText(maxLen = 240) {
    const raw = recipeTextEl.textContent || '';
    if (raw.length <= maxLen) return encodeURIComponent(raw);
    return encodeURIComponent(raw.slice(0, maxLen - 1) + '…');
  }

  shareX.addEventListener('click', () => {
    openShare(`https://twitter.com/intent/tweet?text=${getShareText(240)}`);
  });
  shareFacebook.addEventListener('click', () => {
    openShare(`https://www.facebook.com/sharer/sharer.php?u=${pageUrl}`);
  });
  shareLine.addEventListener('click', () => {
    openShare(`https://social-plugins.line.me/lineit/share?url=${pageUrl}`);
  });
  shareEmail.addEventListener('click', () => {
    try {
      location.href = `mailto:?subject=${pageTitle}&body=${encodeURIComponent(recipeTextEl.textContent + '\n\n' + location.href)}`;
    } catch (e) {
      console.error('メールリンク生成エラー', e);
      showToast('メール共有に失敗しました');
    }
  });

  // トースト通知（アクセシビリティ対応）
  function showToast(msg, timeout = 2000) {
    let t = document.getElementById('toast');
    if (!t) {
      t = document.createElement('div');
      t.id = 'toast';
      t.setAttribute('role', 'status');
      t.setAttribute('aria-live', 'polite');
      t.style.position = 'fixed';
      t.style.left = '50%';
      t.style.transform = 'translateX(-50%)';
      t.style.bottom = '24px';
      t.style.padding = '8px 12px';
      t.style.background = 'rgba(0,0,0,0.8)';
      t.style.color = '#fff';
      t.style.borderRadius = '6px';
      t.style.zIndex = '9999';
      t.style.transition = 'opacity 0.2s ease';
      t.style.opacity = '0';
      document.body.appendChild(t);
    }
    t.textContent = msg;
    t.style.opacity = '1';
    setTimeout(() => {
      t.style.opacity = '0';
    }, timeout);
  }

  // レスポンシブ時にボタンリンクのurlを更新（recipeが変わったら使う想定）
  recipeTextEl.addEventListener('input', () => {
    // place for dynamic updates if needed
  });

  // 初期アクセシビリティ補助（ボタンに aria-label を付与）
  function ensureAria() {
    if (todayBtn && !todayBtn.getAttribute('aria-label')) todayBtn.setAttribute('aria-label', '今日のレシピを表示');
    if (copyBtn && !copyBtn.getAttribute('aria-label')) copyBtn.setAttribute('aria-label', 'レシピをコピー');
    if (pngBtn && !pngBtn.getAttribute('aria-label')) pngBtn.setAttribute('aria-label', 'レシピを画像で保存');
    if (nativeShareBtn && !nativeShareBtn.getAttribute('aria-label')) nativeShareBtn.setAttribute('aria-label', 'ネイティブ共有を開く');
    if (shareX && !shareX.getAttribute('aria-label')) shareX.setAttribute('aria-label', 'Xで共有');
    if (shareFacebook && !shareFacebook.getAttribute('aria-label')) shareFacebook.setAttribute('aria-label', 'Facebookで共有');
    if (shareLine && !shareLine.getAttribute('aria-label')) shareLine.setAttribute('aria-label', 'LINEで共有');
    if (shareEmail && !shareEmail.getAttribute('aria-label')) shareEmail.setAttribute('aria-label', 'メールで共有');
  }
  ensureAria();
});