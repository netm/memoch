document.addEventListener('DOMContentLoaded', () => {
    // 選択肢の初期値
    const options = {
        gender: '男性',
        length: '通常',
        formality: '親しい',
        relationship: '上司・先輩',
        reason: '定年退職'
    };

    // DOM要素取得
    const messageOutput      = document.getElementById('message-output');
    const optionButtons      = document.querySelectorAll('.option-btn');
    const copyBtn            = document.getElementById('copy-btn');
    const printBtn           = document.getElementById('print-btn');
    const pngBtn             = document.getElementById('png-btn');
    const pdfBtn             = document.getElementById('pdf-btn');
    const printableContent   = document.getElementById('printable-content');

    // --- メッセージデータ（男性・女性をまとめて1つに） ---
    const messages = {
        '男性': {
            '上司・先輩': {
                '定年退職': {
                    '親しい': {
                        '通常': '〇〇さん、長年にわたるご勤務、本当にお疲れ様でした。いつも温かいご指導をいただき、心から感謝しております。これからは、ご自身の時間を満喫してください。またお会いできる日を楽しみにしております。',
                        'シンプル': '〇〇さん、長年のご勤務お疲れ様でした。大変お世話になりました。今後のご健勝とご活躍を心よりお祈り申し上げます。'
                    },
                    '親しくない': {
                        '通常': '〇〇様、長年にわたり会社へご尽力いただき、誠にありがとうございました。〇〇様からいただいたご指導を胸に、今後も業務に邁進してまいります。今後のご健勝とご多幸を心よりお祈り申し上げます。',
                        'シンプル': '〇〇様、長年のご勤務、誠にお疲れ様でした。公私にわたりお世話になりましたこと、心より感謝申し上げます。'
                    }
                },
                '転職': {
                    '親しい': {
                        '通常': '〇〇さん、転職おめでとうございます！新しい環境での挑戦、心から応援しています。〇〇さんと一緒に仕事ができて本当に楽しかったです。また近いうちに飲みに行きましょう！',
                        'シンプル': '〇〇さん、転職おめでとうございます！新天地でのご活躍を期待しています。今までありがとうございました。'
                    },
                    '親しくない': {
                        '通常': '〇〇様、この度はご栄転、誠におめでとうございます。在職中はひとかたならぬご厚情を賜り、ありがとうございました。新天地でのますますのご活躍を心よりお祈りしております。',
                        'シンプル': '〇〇様、転職おめでとうございます。これまで大変お世話になりました。今後のご活躍を心よりお祈り申し上げます。'
                    }
                },
                '結婚': {
                    '親しい': {
                        '通常': '〇〇さん、ご結婚おめでとうございます！これからは家庭と仕事の両立で大変かと思いますが、〇〇さんならきっと大丈夫です。末永くお幸せに！',
                        'シンプル': '〇〇さん、ご結婚おめでとうございます！素敵な家庭を築いてください。本当におめでとう！'
                    },
                    '親しくない': {
                        '通常': '〇〇様、この度はご結婚おめでとうございます。在職中は公私にわたり大変お世話になりました。末永いお幸せを心よりお祈り申し上げます。',
                        'シンプル': '〇〇様、ご結婚おめでとうございます。今後のご多幸を心よりお祈り申し上げます。'
                    }
                },
                 '妊娠・出産': {
                     '親しい': {          '通常': '〇〇さん、この度はお子さんのご誕生、誠におめでとうございます。育児に専念されるとのこと、赤ちゃんとのかけがえのない時間をゆっくりお楽しみください。',
          'シンプル': '〇〇さん、お子さんご誕生おめでとうございます。育児、楽しんでくださいね。'
                    },
                    '親しくない': {
          '通常': '〇〇様、この度はお子様のご誕生、心よりお祝い申し上げます。育児に専念されるとのこと、健やかな子育てをお祈りしております。',
          'シンプル': '〇〇様、お子様誕生おめでとうございます。育児をお大事に。'

                    }
                }
            },
            '同期': {
                '定年退職': {
                    '親しい': {
                        '通常': '〇〇、長い間本当にお疲れ様でした。同期として共に励まし合い、時には競い合った日々が懐かしいです。これからはゆっくり羽を伸ばして、第二の人生を楽しんでください。また会いましょう！',
                        'シンプル': '〇〇、本当にお疲れ様でした。これからは自分の時間を楽しんでください。また連絡します！'
                    },
                    '親しくない': {
                        '通常': '〇〇さん、長年のご勤務、お疲れ様でした。同期として多くのことを学ばせていただきました。今後のご健勝を心からお祈りしております。',
                        'シンプル': '〇〇さん、長い間お疲れ様でした。今後のご活躍をお祈りしています。'
                    }
                },
                '転職': {
                    '親しい': {
                        '通常': '〇〇、転職おめでとう！寂しくなるけど、新しい場所で頑張る〇〇を応援してるよ。最高の同期でした。ありがとう！また絶対集まろうな！',
                        'シンプル': '転職おめでとう！〇〇ならどこでも大丈夫。応援してるよ！'
                    },
                    '親しくない': {
                        '通常': '〇〇さん、転職おめでとうございます。同期として刺激を受けることが多かったです。新天地でのご成功を心からお祈りしています。',
                        'シンプル': '〇〇さん、転職おめでとうございます。新天地でのご活躍を祈っています。'
                    }
                },
                '結婚': {
                    '親しい': {
                        '通常': '〇〇、結婚おめでとう！同期の幸せな報告が聞けて、本当に嬉しいです。素敵な家庭を築いてね。末永くお幸せに！',
                        'シンプル': '結婚おめでとう！本当に嬉しいです。末永くお幸せに！'
                    },
                    '親しくない': {
                        '通常': '〇〇さん、ご結婚おめでとうございます。同期として、この佳き日を迎えられたことを心よりお祝い申し上げます。末永いお幸せをお祈りしています。',
                        'シンプル': '〇〇さん、ご結婚おめでとうございます。どうぞお幸せに。'
                    }
                },
                '妊娠・出産': {
                    '親しい': {
                       '通常': '〇〇、家族が増えるんだね！お子さんご誕生、本当におめでとう。育児に専念して、たくさん思い出を作ってね。また赤ちゃんの顔を見せてほしいな。',
          'シンプル': '〇〇、お子さん誕生おめでとう！育児、楽しんでね。'
                    },
                    '親しくない': {
                        '通常': '〇〇さん、この度はお子様のご誕生、心よりお祝い申し上げます。育児に専念されるとのこと、母子ともにご健康をお祈りいたします。',
          'シンプル': '〇〇さん、お子様誕生おめでとうございます。育児をお大事に。'
                    }
                }
            },
            '部下・後輩': {
                '定年退職': {
                    '親しい': {
                        '通常': '〇〇さん、長い間、本当にお疲れ様でした。〇〇さんの丁寧な仕事ぶりにはいつも助けられていました。これからはゆっくりとご自身の時間を楽しんでください。',
                        'シンプル': '〇〇さん、長い間お疲れ様でした。これからはご自身の時間を楽しんでください。'
                    },
                    '親しくない': {
                        '通常': '〇〇さん、長年のご勤務、誠にお疲れ様でした。会社へのご貢献に深く感謝いたします。今後の人生が実り多きものとなりますよう、お祈り申し上げます。',
                        'シンプル': '〇〇さん、長年のご勤務お疲れ様でした。今後のご健勝をお祈り申し上げます。'
                    }
                },
                '転職': {
                    '親しい': {
                        '通常': '〇〇君、転職おめでとう。君の新しい挑戦を心から応援しています。ここで培った経験を活かして、次のステージでも頑張ってください。いつでも相談に乗るよ。',
                        'シンプル': '〇〇君、転職おめでとう。新天地での活躍を期待しています。頑張れ！'
                    },
                    '親しくない': {
                        '通常': '〇〇さん、転職おめでとうございます。〇〇さんの今後のご活躍を心よりお祈り申し上げます。今後のご発展を期待しております。',
                        'シンプル': '〇〇さん、転職おめでとうございます。新天地でのご活躍をお祈りしています。'
                    }
                },
                '結婚': {
                    '親しい': {
                        '通常': '〇〇君、結婚おめでとう！これからは一家の大黒柱として、仕事も家庭も頑張ってください。何かあればいつでも頼ってね。末永くお幸せに！',
                        'シンプル': '〇〇君、結婚おめでとう！素敵な家庭を築いてください。'
                    },
                    '親しくない': {
                        '通常': '〇〇さん、ご結婚おめでとうございます。これからの人生が素晴らしいものになるよう、心からお祈りしています。どうぞ末永くお幸せに。',
                        'シンプル': '〇〇さん、ご結婚おめでとうございます。末永いお幸せをお祈りいたします。'
                    }
                },
                '妊娠・出産': {
                    '親しい': {
                        '通常': '〇〇さん、この度はお子さんの誕生、本当におめでとうございます。育児のために退職されるとのこと、赤ちゃんとのひとときを大切にしてくださいね。',
          'シンプル': '〇〇さん、お子さん誕生おめでとうございます。育児、楽しんで！'
                    },
                    '親しくない': {
                        '通常': '〇〇さん、お子様のご誕生、誠におめでとうございます。育児に専念されるとのこと、心よりご健康とご多幸をお祈り申し上げます。',
          'シンプル': '〇〇さん、お子様誕生おめでとうございます。育児をお大事に。'
                    }
                }
            },
            '家族': {
                '定年退職': {
                    '親しい': {
                        '通常': 'お父さん（おじいちゃん）、長い間のお仕事、本当にお疲れ様でした。家族のために一生懸命働いてくれて、心から感謝しています。これからはゆっくり休んで、趣味の時間を楽しんでね。',
                        'シンプル': 'お父さん（おじいちゃん）、長い間お仕事お疲れ様でした。これからはゆっくりしてね。'
                    },
                    '親しくない': {
                        '通常': 'お父様、長年にわたるお勤め、誠にご苦労様でした。一家の主として私達を支えてくださったことに、深く感謝申し上げます。これからはどうか、お体を大切にお過ごしください。',
                        'シンプル': 'お父様、長年のお勤め、ご苦労様でした。心より感謝申し上げます。'
                    }
                },
                '転職': {
                    '親しい': {
                        '通常': '新しいお仕事、頑張ってね！大変なこともあると思うけど、いつでも応援しています。無理せず、あなたのペースで進んでいってください。',
                        'シンプル': '新しい仕事、頑張ってね！応援しています。'
                    },
                    '親しくない': {
                        '通常': 'この度の転職、心よりお祝い申し上げます。新しい職場でのご活躍と、今後のご健勝を家族一同お祈りしております。',
                        'シンプル': '転職おめでとうございます。新しい職場でのご活躍をお祈りしています。'
                    }
                },
                 '結婚': {
                    '親しい': {
                        '通常': '〇〇、結婚おめでとう！素敵なパートナーと巡り会えて、家族みんなが喜んでいます。二人で力を合わせて、笑顔の絶えない温かい家庭を築いていってね。',
                        'シンプル': '結婚おめでとう！二人で力を合わせ、幸せな家庭を築いてね。'
                    },
                    '親しくない': {
                        '通常': 'この度はご結婚、誠におめでとうございます。お二人の輝かしい門出を祝福し、末永いご多幸を心よりお祈り申し上げます。',
                        'シンプル': 'ご結婚おめでとうございます。末永いお幸せをお祈りいたします。'
                    }
                },
                '妊娠・出産': {
                    '親しい': {
                        '通常': '〇〇、子どもの誕生おめでとうございます。これからは家族みんなで赤ちゃんを囲んで、楽しい毎日を過ごしてくださいね。',
          'シンプル': '〇〇、子どもの誕生おめでとう！家族みんなで楽しんでね。'
                    },
                    '親しくない': {
                       '通常': '〇〇、お子様の誕生、誠におめでとうございます。ご家庭に新たな喜びが加わり、皆様ご健勝でありますようお祈り申し上げます。',
          'シンプル': '〇〇、お子様の誕生おめでとうございます。お体を大切に。'
                    }
                }
            }
        },
    '女性': {
        '上司・先輩': {
            '定年退職': {
                '親しい': {
                    '通常': '〇〇さん、長年にわたるご勤務、本当にお疲れ様でした。いつも温かいご指導をいただき、心から感謝しております。これからは、ご自身の時間を満喫してください。またお会いできる日を楽しみにしております。',
                    'シンプル': '〇〇さん、長年のご勤務お疲れ様でした。大変お世話になりました。今後のご健勝とご活躍を心よりお祈り申し上げます。'
                },
                '親しくない': {
                    '通常': '〇〇様、長年にわたり会社へご尽力いただき、誠にありがとうございました。〇〇様からいただいたご指導を胸に、今後も業務に邁進してまいります。今後のご健勝とご多幸を心よりお祈り申し上げます。',
                    'シンプル': '〇〇様、長年のご勤務、誠にお疲れ様でした。公私にわたりお世話になりましたこと、心より感謝申し上げます。'
                }
            },
            '転職': {
                '親しい': {
                    '通常': '〇〇さん、転職おめでとうございます！新しい環境での挑戦、心から応援しています。〇〇さんとご一緒に働けて本当に楽しかったです。また近いうちにお食事に行きましょう！',
                    'シンプル': '〇〇さん、転職おめでとうございます！新天地でのご活躍を期待しています。今までありがとうございました。'
                },
                '親しくない': {
                    '通常': '〇〇様、この度はご栄転、誠におめでとうございます。在職中はひとかたならぬご厚情を賜り、ありがとうございました。新天地でのますますのご活躍を心よりお祈りしております。',
                    'シンプル': '〇〇様、転職おめでとうございます。これまで大変お世話になりました。今後のご活躍を心よりお祈り申し上げます。'
                }
            },
            '結婚': {
                '親しい': {
                    '通常': '〇〇さん、ご結婚おめでとうございます！これからは家庭と仕事の両立で大変かと思いますが、〇〇さんならきっと大丈夫です。末永くお幸せに！',
                    'シンプル': '〇〇さん、ご結婚おめでとうございます！素敵な家庭を築いてください。本当におめでとう！'
                },
                '親しくない': {
                    '通常': '〇〇様、この度はご結婚おめでとうございます。在職中は公私にわたり大変お世話になりました。末永いお幸せを心よりお祈り申し上げます。',
                    'シンプル': '〇〇様、ご結婚おめでとうございます。今後のご多幸を心よりお祈り申し上げます。'
                }
            },
            '妊娠・出産': {
                '親しい': {
                    '通常': '〇〇さん、ご退職されると聞き寂しくなりますが、ご懐妊おめでとうございます！元気な赤ちゃんをお迎えくださいね。落ち着いたら、ぜひ赤ちゃんの顔を見せに来てください。',
                    'シンプル': '〇〇さん、おめでとうございます！身体を大切に、元気な赤ちゃんを産んでくださいね。'
                },
                '親しくない': {
                    '通常': '〇〇様、この度はご懐妊おめでとうございます。どうぞお体を大切になさって、元気な赤ちゃんをご出産ください。今まで大変お世話になりました。',
                    'シンプル': '〇〇様、ご出産準備のためのご退職、寂しくなりますが、どうぞお体をお大事になさってください。'
                }
            }
        },
        '同期': {
            '定年退職': {
                '親しい': {
                    '通常': '〇〇、本当に長い間お疲れ様でした。同期として共に励まし合い、時には切磋琢磨した日々が懐かしいです。これからはゆっくり羽を伸ばして、第二の人生を楽しんでください。また会おうね！',
                    'シンプル': '〇〇、本当にお疲れ様でした。これからは自分の時間を楽しんでね。また連絡するね！'
                },
                '親しくない': {
                    '通常': '〇〇さん、長年のご勤務、お疲れ様でした。同期として多くのことを学ばせていただきました。今後のご健勝を心よりお祈り申し上げます。',
                    'シンプル': '〇〇さん、長い間お疲れ様でした。今後のご活躍をお祈りしています。'
                }
            },
            '転職': {
                '親しい': {
                    '通常': '〇〇、転職おめでとう！寂しくなるけど、新しい場所でも頑張る〇〇を応援しているよ。最高の同期でした。ありがとう！また絶対集まろうね！',
                    'シンプル': '転職おめでとう！〇〇ならどこでも大丈夫。応援しているよ！'
                },
                '親しくない': {
                    '通常': '〇〇さん、転職おめでとうございます。同期として刺激を受けることが多かったです。新天地でのご成功を心よりお祈り申し上げます。',
                    'シンプル': '〇〇さん、転職おめでとうございます。新天地でのご活躍をお祈りしています。'
                }
            },
            '結婚': {
                '親しい': {
                    '通常': '〇〇、結婚おめでとう！同期の幸せな報告が聞けて本当に嬉しいよ。素敵な家庭を築いてね。末永くお幸せに！',
                    'シンプル': '結婚おめでとう！本当に嬉しいよ。末永くお幸せに！'
                },
                '親しくない': {
                    '通常': '〇〇さん、ご結婚おめでとうございます。同期として、この佳き日を迎えられたことを心よりお祝い申し上げます。末永いお幸せをお祈りしています。',
                    'シンプル': '〇〇さん、ご結婚おめでとうございます。どうぞお幸せに。'
                }
            },
            '妊娠・出産': {
                '親しい': {
                    '通常': '〇〇、退職は寂しいけどおめでとう！体調に気をつけて、元気な赤ちゃんを産んでね。落ち着いたら赤ちゃんの顔を見せに来て！',
                    'シンプル': '〇〇、おめでとう！身体を第一に、元気な赤ちゃんを産んでね。'
                },
                '親しくない': {
                    '通常': '〇〇さん、この度は誠におめでとうございます。退職されるのは寂しいですが、どうぞお体を大切になさってください。母子ともに健康でありますようお祈りしております。',
                    'シンプル': '〇〇さん、おめでとうございます。どうぞお体を大切にしてください。'
                }
            }
        },
        '部下・後輩': {
            '定年退職': {
                '親しい': {
                    '通常': '〇〇さん、長い間本当にお疲れ様でした。〇〇さんの丁寧な仕事ぶりにはいつも助けられていました。これからはゆっくりとご自身の時間を楽しんでください。',
                    'シンプル': '〇〇さん、長い間お疲れ様でした。これからはご自身の時間を楽しんでください。'
                },
                '親しくない': {
                    '通常': '〇〇さん、長年のご勤務、誠にお疲れ様でした。会社へのご貢献に深く感謝いたします。今後の人生が実り多きものとなりますよう、お祈り申し上げます。',
                    'シンプル': '〇〇さん、長年のご勤務お疲れ様でした。今後のご健勝をお祈り申し上げます。'
                }
            },
            '転職': {
                '親しい': {
                    '通常': '〇〇さん、転職おめでとう。あなたの新しい挑戦を心から応援しています。ここで培った経験を活かして、次のステージでも頑張ってください。いつでも相談に乗ります。',
                    'シンプル': '〇〇さん、転職おめでとう。新天地での活躍を期待しています。頑張ってください！'
                },
                '親しくない': {
                    '通常': '〇〇さん、転職おめでとうございます。〇〇さんの今後のご活躍を心よりお祈り申し上げます。今後のご発展を期待しております。',
                    'シンプル': '〇〇さん、転職おめでとうございます。新天地でのご活躍をお祈りしています。'
                }
            },
            '結婚': {
                '親しい': {
                    '通常': '〇〇さん、結婚おめでとう！これからは家庭と仕事の両立で忙しくなると思いますが、何かあればいつでも頼ってください。末永くお幸せに！',
                    'シンプル': '〇〇さん、結婚おめでとう！素敵な家庭を築いてください。'
                },
                '親しくない': {
                    '通常': '〇〇さん、ご結婚おめでとうございます。これからの人生が素晴らしいものになるよう、心からお祈りしています。どうぞ末永くお幸せに。',
                    'シンプル': '〇〇さん、ご結婚おめでとうございます。末永いお幸せをお祈りいたします。'
                }
            },
            '妊娠・出産': {
                '親しい': {
                    '通常': '〇〇さん、退職は残念ですが、ご懐妊おめでとうございます！これからは赤ちゃんのためにもゆったり過ごしてくださいね。元気な赤ちゃんを産んでください！',
                    'シンプル': '〇〇さん、おめでとう！身体を大切に、元気な赤ちゃんを産んでね。'
                },
                '親しくない': {
                    '通常': '〇〇さん、この度はご懐妊おめでとうございます。退職されるのは寂しくなりますが、どうぞお体を大切に、元気な赤ちゃんをご出産ください。',
                    'シンプル': '〇〇さん、おめでとうございます。どうぞお体を大切になさってください。'
                }
            }
        },
        '家族': {
            '定年退職': {
                '親しい': {
                    '通常': 'お母さん（おばあちゃん）、長い間のお仕事、本当にお疲れ様でした。家族のために一生懸命働いてくれて、心から感謝しています。これからはゆっくり休んで、趣味の時間を楽しんでね。',
                    'シンプル': 'お母さん（おばあちゃん）、長い間お仕事お疲れ様でした。これからはゆっくりしてね。'
                },
                '親しくない': {
                    '通常': 'お母様、長年にわたるお勤め、誠にご苦労様でした。一家の主として私たちを支えてくださったことに、深く感謝申し上げます。これからはどうか、お体を大切にお過ごしください。',
                    'シンプル': 'お母様、長年のお勤め、ご苦労様でした。心より感謝申し上げます。'
                }
            },
            '転職': {
                '親しい': {
                    '通常': '新しいお仕事、頑張ってね！大変なこともあると思うけど、いつでも応援しています。無理せず、あなたのペースで進んでいってください。',
                    'シンプル': '新しい仕事、頑張ってね！応援しています。'
                },
                '親しくない': {
                    '通常': 'この度の転職、心よりお祝い申し上げます。新しい職場でのご活躍と、今後のご健勝を家族一同お祈りしております。',
                    'シンプル': '転職おめでとうございます。新しい職場でのご活躍をお祈りしています。'
                }
            },
            '結婚': {
                '親しい': {
                    '通常': '〇〇、結婚おめでとう！素敵なパートナーと巡り会えて、家族みんなが喜んでいます。二人で力を合わせて、笑顔の絶えない温かい家庭を築いていってね。',
                    'シンプル': '結婚おめでとう！二人で力を合わせ、幸せな家庭を築いてね。'
                },
                '親しくない': {
                    '通常': 'この度はご結婚、誠におめでとうございます。お二人の輝かしい門出を祝福し、末永いご多幸を心よりお祈り申し上げます。',
                    'シンプル': 'ご結婚おめでとうございます。末永いお幸せをお祈りいたします。'
                }
            },
            '妊娠・出産': {
                '親しい': {
                    '通常': '〇〇、いよいよですね！これまでお仕事大変だったと思いますが、これからは自分の体と赤ちゃんのことを一番に考えて、ゆっくり過ごしてね。家族みんなでサポートするから！',
                    'シンプル': 'これからは自分の体を第一に考えてね。家族みんなでサポートします。'
                },
                '親しくない': {
                    '通常': '退職して出産準備に入られるとのこと、どうぞお体を大切にお過ごしください。家族として、健やかなご出産を心より願っております。',
                    'シンプル': 'お体を大切に、健やかなご出産を願っております。'
                }
            }
        }
    }
};
    // --- メッセージ生成関数 ---
    const generateMessage = () => {
        try {
            const { gender, relationship, reason, formality, length } = options;
            const msg = messages[gender]
                      && messages[gender][relationship]
                      && messages[gender][relationship][reason]
                      && messages[gender][relationship][reason][formality]
                      && messages[gender][relationship][reason][formality][length];
            messageOutput.value = msg || "該当するメッセージが見つかりませんでした。";
        } catch (e) {
            console.error(e);
            messageOutput.value = "条件に合うメッセージの生成に失敗しました。";
        }
    };

    // --- イベントリスナー ---
    optionButtons.forEach(btn => {
        btn.addEventListener('click', () => {
            const group = btn.dataset.group;
            const value = btn.dataset.value;
            // 同じグループのボタンをクリア
            document.querySelectorAll(`.option-btn[data-group="${group}"]`)
                    .forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            options[group] = value;
            generateMessage();
        });
    });

    copyBtn.addEventListener('click', () => {
        if (!messageOutput.value) return;
        navigator.clipboard.writeText(messageOutput.value)
            .then(() => alert('メッセージをコピーしました。'))
            .catch(() => alert('コピーに失敗しました。'));
    });

    printBtn.addEventListener('click', () => window.print());

    // --- PNG/PDF生成 ---
    const generateImage = async format => {
        if (!messageOutput.value) return;
        const style = window.getComputedStyle(messageOutput);
        printableContent.innerText = messageOutput.value;
        printableContent.style.cssText = [
            `width:${messageOutput.clientWidth}px`,
            `height:${messageOutput.clientHeight}px`,
            `padding:${style.padding}`,
            `font:${style.font}`,
            `line-height:${style.lineHeight}`,
            'white-space:pre-wrap',
            'word-wrap:break-word',
            'border:1px solid #ccc',
            'background-color:#fff',
            'display:block'
        ].join(';');
        try {
            const canvas = await html2canvas(printableContent, { useCORS: true, scale: 2 });
            if (format === 'png') {
                const a = document.createElement('a');
                a.href = canvas.toDataURL('image/png');
                a.download = 'message.png';
                a.click();
            } else {
                const { jsPDF } = window.jspdf;
                const img = canvas.toDataURL('image/jpeg', 0.9);
                const pdf = new jsPDF({ orientation:'portrait', unit:'px', format:[canvas.width,canvas.height] });
                pdf.addImage(img, 'JPEG', 0, 0, canvas.width, canvas.height);
                pdf.save('message.pdf');
            }
        } catch (err) {
            console.error(err);
            alert('ファイルの生成に失敗しました。');
        } finally {
            printableContent.style.display = 'none';
        }
    };

    pngBtn.addEventListener('click', () => generateImage('png'));
    pdfBtn.addEventListener('click', () => generateImage('pdf'));

    // --- 初回表示 ---
    generateMessage();
});
